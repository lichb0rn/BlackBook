/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var T=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var F=(g,o)=>{for(var t in o)T(g,t,{get:o[t],enumerable:!0})},D=(g,o,t,i)=>{if(o&&typeof o=="object"||typeof o=="function")for(let e of E(o))!y.call(g,e)&&e!==t&&T(g,e,{get:()=>o[e],enumerable:!(i=C(o,e))||i.enumerable});return g};var L=g=>D(T({},"__esModule",{value:!0}),g);var I={};F(I,{default:()=>d});module.exports=L(I);var m=require("obsidian"),v=require("@codemirror/view");var l=require("obsidian"),p=class extends l.PluginSettingTab{constructor(t,i){super(t,i);this.plugin=i}display(){let{containerEl:t}=this;t.empty(),new l.Setting(t).setName("Slash trigger").setDesc("Enter a character that will trigger template insert suggestion").addText(e=>e.setPlaceholder("Slash trigger").setValue(this.plugin.settings.slashTrigger).onChange(async s=>{s&&s.length>1?(new l.Notice("Please use one character to avoid conflict"),e.setValue(s[0])):(this.plugin.settings.slashTrigger=s,await this.plugin.saveSettings())})),new l.Setting(t).setName("Fuzzy Search").setDesc("You don\u2019t have to type the exact name.If the letters appear in the right order, it will match.Example: \u2018btn\u2019 \u2192 \u2018Button\u2019.").addToggle(e=>{e.setValue(this.plugin.settings.fuzzySearch).onChange(async s=>{this.plugin.settings.fuzzySearch=s,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Highlight").setDesc("Highlight matching terms of search results").addToggle(e=>{e.setValue(this.plugin.settings.highlight).onChange(async s=>{this.plugin.settings.highlight=s,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show full path of the snippet file").addToggle(e=>{e.setValue(this.plugin.settings.showPath).onChange(async s=>{this.plugin.settings.showPath=s,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show snippet content").addToggle(e=>{e.setValue(this.plugin.settings.showFileContent).onChange(async s=>{this.plugin.settings.showFileContent=s,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Show last selected text").addToggle(e=>{e.setValue(this.plugin.settings.showSelectedText).onChange(async s=>{this.plugin.settings.showSelectedText=s,await this.plugin.saveSettings()})}),new l.Setting(t).setName("Snippet path").setDesc("Set a folder that has all the snippets files").addText(e=>e.setPlaceholder("Snippet path").setValue(this.plugin.settings.snippetPath).onChange(async s=>{this.plugin.settings.snippetPath=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Text Selection").setDesc("Set a variable to replace text with last text selection").addText(e=>e.setPlaceholder("%% textSelection %%").setValue(this.plugin.settings.textSelectionString).onChange(async s=>{this.plugin.settings.textSelectionString=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Cursor position").setDesc("Set a variable for where to put the cursor after snippet has inserted").addText(e=>e.setPlaceholder("%% cursor %%").setValue(this.plugin.settings.cursorPositionString).onChange(async s=>{this.plugin.settings.cursorPositionString=s,await this.plugin.saveSettings()})),new l.Setting(t).setName("Ignore properties").setDesc("Enable this if you don't want to insert properties values in the snippets notes").addToggle(e=>{e.setValue(this.plugin.settings.ignoreProperties).onChange(async s=>{this.plugin.settings.ignoreProperties=s,await this.plugin.saveSettings()})});let i=document.createDocumentFragment();i.append("Enable this if you want to use ",i.createEl("a",{href:"https://github.com/SilentVoid13/Templater",text:"Templater"})," files inside snippets. (To use this, you need Templater plugin enabled)"),new l.Setting(t).setName("Enable Templater plugin support").setDesc(i).addToggle(e=>{e.setValue(this.plugin.settings.templaterSupport).onChange(async s=>{this.plugin.settings.templaterSupport=s,await this.plugin.saveSettings()})})}};var b=require("obsidian"),c=class extends b.EditorSuggest{constructor(t){super(t.app);this.DEFAULT_SCORE=1;this.START_WITH_SCORE=2;this.plugin=t}getAllSnippets(t){if(t.startsWith(" "))return[];if(t=="")return this.getLastUsedSnippetFiles();let i=[];for(let e=0;e<this.plugin.snippetFiles.length;e++){let s=this.plugin.snippetFiles[e],n=0;if(this.plugin.settings.fuzzySearch){let a=this.fuzzyMatch(s.name,t);s.name.startsWith(t)?n=this.START_WITH_SCORE:n=this.DEFAULT_SCORE,a&&i.push({filePath:s.path,positions:a,score:n})}else s.name.toLowerCase().contains(t.toLowerCase())&&(n=this.DEFAULT_SCORE,i.push({filePath:s.path,positions:[],score:n}))}return i.sort((e,s)=>s.score-e.score),i}fuzzyMatch(t,i){let e=0,s=0,n=[];for(t=t.toLowerCase(),i=i.toLowerCase();e<t.length&&s<i.length;)t[e]===i[s]&&(s++,this.plugin.settings.highlight&&n.push(e)),t[e]===i[s]&&s++,e++;return s===i.length?this.plugin.settings.highlight?n:[]:!1}getSuggestions(t){return this.getAllSnippets(t.query)}onTrigger(t,i,e){let s=i.getLine(t.line).slice(0,t.ch);if(!s.contains(this.plugin.settings.slashTrigger))return null;let n=s.lastIndexOf(this.plugin.settings.slashTrigger),a=s.slice(n+1,s.length);return{start:{...t,ch:n},end:t,query:a}}removeFrontmatter(t){return t?this.plugin.settings.ignoreProperties&&t.startsWith("---")?t.replace(/^---\n[\s\S]*?\n---\n?/,""):t:""}async selectSuggestion(t,i){var f,u,h,S,x,w,P;let e=this.plugin.app.vault.getFileByPath(t.filePath);if(!e)return;let s=await this.plugin.app.vault.cachedRead(e),n=this.removeFrontmatter(s),a=n.indexOf(this.plugin.settings.textSelectionString);console.log(`textSelectionPos ${a}`);let r=n.indexOf(this.plugin.settings.cursorPositionString);r&&(n=n.replace(this.plugin.settings.cursorPositionString,"")),this.plugin.selectedText?n=n.replace(this.plugin.settings.textSelectionString,this.plugin.selectedText):n=n.replace(this.plugin.settings.textSelectionString,""),this.plugin.selectedText="",(f=this.context)==null||f.editor.replaceRange(n,this.context.start,this.context.end),r&&r>0?(S=this.context)==null||S.editor.setCursor({line:(u=this.context)==null?void 0:u.start.line,ch:((h=this.context)==null?void 0:h.start.ch)+r}):a&&((P=this.context)==null||P.editor.setCursor({line:(x=this.context)==null?void 0:x.start.line,ch:((w=this.context)==null?void 0:w.start.ch)+a})),this.plugin.settings.templaterSupport&&await this.plugin.runTemplaterReplace(),localStorage.setItem(t.filePath,String(Date.now())),this.close()}getLastUsedSnippetFiles(){let t=[];return this.plugin.snippetFiles.map(i=>{let e=localStorage.getItem(i.path),s={filePath:i.path,positions:[],score:e?Number(e):0};t.push(s)}),t.sort((i,e)=>e.score-i.score),t}buildHighlighted(t,i){let e="";for(let s=0;s<t.length;s++)i.includes(s)?e+=`<b class="slash-fuzzy-match">${t[s]}</b>`:e+=t[s];return e}async renderSuggestion(t,i){let e=this.plugin.app.vault.getFileByPath(t.filePath);if(!e)return;let s=await this.plugin.app.vault.cachedRead(e),n=t.positions;if(this.plugin.settings.highlight&&n){let a=i.createEl("div");a.innerHTML=this.buildHighlighted(e.basename,n)}else i.createEl("div",{text:e.basename});if(this.plugin.settings.showPath&&i.createEl("small",{cls:"slash-path",text:t.filePath}),this.plugin.settings.showFileContent&&i.createDiv({cls:"slash-file"}).createEl("small",{cls:"slash-file-content",text:s.trim()}),this.plugin.settings.showSelectedText&&this.plugin.selectedText&&s.contains(this.plugin.settings.textSelectionString)){let a="";this.plugin.selectedText.length>this.plugin.settings.maxSelectedTextLength?a=`${this.plugin.selectedText.substring(0,this.plugin.settings.maxSelectedTextLength).trim()}...`:a=this.plugin.selectedText.substring(0,10).trim(),i.createEl("small",{text:a,cls:"insert_text"})}}unload(){}};var O={slashTrigger:"/",fuzzySearch:!0,highlight:!0,showPath:!1,showFileContent:!1,snippetPath:"Snippets",ignoreProperties:!0,templaterSupport:!0,textSelectionString:"%%textSelection%%",cursorPositionString:"%%cursor%%",maxSelectedTextLength:50,showSelectedText:!1},d=class extends m.Plugin{constructor(){super(...arguments);this.snippetFiles=[]}async onload(){await this.loadSettings(),this.registerEditorSuggest(new c(this)),this.addSettingTab(new p(this.app,this)),this.loadAllTemplatedFiles(),this.listenForUpdates();let t=v.EditorView.updateListener.of(i=>{if(i.docChanged)for(let e of i.transactions)e.changes.iterChanges((n,a,r,f,u)=>{let h=e.startState.doc.sliceString(n,a),S=u.toString();h.length>0&&S===this.settings.slashTrigger&&(this.selectedText=h)})});this.registerEditorExtension(t)}loadAllTemplatedFiles(){let t=this.app.vault.getMarkdownFiles(),i=[];for(let e=0;e<t.length;e++){let s=t[e];if(s.path.startsWith(`${this.settings.snippetPath}/`)&&(i.push(s),!localStorage.getItem(s.path))){let a=Date.now();localStorage.setItem(s.path,String(a))}}this.snippetFiles=i}listenForUpdates(){this.registerEvent(this.app.vault.on("create",t=>{if(t.path.startsWith(`${this.settings.snippetPath}/`)&&(this.snippetFiles.push(t),!localStorage.getItem(t.path))){let e=Date.now();localStorage.setItem(t.path,String(e))}})),this.registerEvent(this.app.vault.on("delete",t=>{t.path.startsWith(`${this.settings.snippetPath}/`)&&(this.snippetFiles.remove(t),localStorage.removeItem(t.path))}))}async runTemplaterReplace(){let t="templater-obsidian:replace-in-file-templater",i="editor:save-file";this.app.commands.executeCommandById(i),(0,m.debounce)(()=>{this.app.commands.executeCommandById(t)},300,!0)()}onunload(){}async loadSettings(){this.settings=Object.assign({},O,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */